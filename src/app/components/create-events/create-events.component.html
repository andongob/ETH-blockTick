<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creación de evento</title>
</head>
<body>

    <h1>Crear un Nuevo Evento</h1>
    
    <form action="procesar_formulario.php" method="POST">
      <!-- Campo para el nombre del evento -->
      <label for="eventName">Nombre del Evento:</label>
      <input type="text" id="eventName" name="eventName" required>
      <br>

      <!-- Campo para el organizador del evento -->
      <label for="eventOrganizer">Organizador del Evento:</label>
      <input type="text" id="eventOrganizer" name="eventOrganizer" required>
      <br>

      <!-- Campo para la categoría del evento -->
      <label for="eventCategory">Categoría del Evento:</label>
      <input type="text" id="eventCategory" name="eventCategory" required>
      <br>

      <!-- Campo para la dirección del dueño del evento -->
      <label for="eventOwner">Address de la persona promotora:</label>
      <input type="text" id="eventOwner" name="eventOwner" required>
      <br>

      <!-- Campo para el precio del evento -->
      <label for="price">Precio del Evento:</label>
      <input type="number" id="price" name="price" required>
      <br>

      <!-- Botón de envío del formulario -->
      <button type="submit">Crear Evento</button>
  </form>

    <h2>Precio del evento</h2>
    
    <!-- Botón para comprar el ticket -->
    <button id="buyTicketButton">Precio Ticket</button>

    <!-- Mensaje de estado de la transacción -->
    <div id="transactionStatus"></div>

    <script>
        //  JavaScript para interactuar con la función buyTicket
        document.getElementById('buyTicketButton').addEventListener('click', async () => {
            try {
                //  del contrato
                const contract = new web3.eth.Contract(factoryABI, '0x33578C5548e8ed6984d0a3705234996EF3d8386D');

                // valor en wei que se enviará con la transacción
                const ticketPriceWei = await contract.methods.getPrice().call();
                const amount = 1; // Cantidad de tickets a comprar (puedes cambiarlo según tus necesidades)
                const totalValueWei = ticketPriceWei * amount;

                // billetera del usuario 
                await this.walletService.initWallet;

                // dirección de la billetera del usuario
                const userAddress = this.walletService.wallet.walletAddress;

                // transacción para comprar el ticket
                const result = await contract.methods.buyTicket().send({
                    from: userAddress,
                    value: totalValueWei,
                });

                if (result.status) {
                    document.getElementById('transactionStatus').textContent = 'Compra de ticket exitosa. Hash de la transacción: ' + result.transactionHash;
                    // Puedes realizar acciones adicionales después de una compra exitosa
                } else {
                    document.getElementById('transactionStatus').textContent = 'La compra de ticket falló.';
                    // Maneja el caso en el que la compra falla
                }
            } catch (error) {
                document.getElementById('transactionStatus').textContent = 'Error comprando ticket: ' + error.message;
                // Maneja el error de la compra de ticket
            }
        });
    </script>
</body>
</html>
